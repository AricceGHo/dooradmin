<!DOCTYPE html>
<html>
<head>
    <title>Выбор компании</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Выберите компанию:</h1>
    <select id="companySelect">
        <option value="">Загрузка...</option>
    </select>

    <script>
        Telegram.WebApp.ready();

        // Функция для отправки запроса боту
        function requestCompanyList() {
            const data = {
                request_id: "get_companies_list_for_webapp"
            };
            Telegram.WebApp.sendData(JSON.stringify(data));
        }

        // Функция для обработки ответа от бота
        function handleCompanyList(companyList) {
            const selectElement = document.getElementById("companySelect");
            selectElement.innerHTML = ""; // Очищаем "Загрузка..."
            companyList.forEach(company => {
                const option = document.createElement("option");
                option.value = company.id;
                option.text = company.name;
                selectElement.appendChild(option);
            });
        }

        // Отправляем запрос боту при загрузке страницы
        requestCompanyList();

        // Слушаем событие 'message' для получения ответа от бота
        Telegram.WebApp.onEvent('message', function(event) {
            if (event.data) {
                try {
                    const companyList = JSON.parse(event.data);
                    handleCompanyList(companyList);
                } catch (error) {
                    console.error("Ошибка при разборе JSON:", error);
                    alert("Ошибка при получении списка компаний.");
                }
            }
        });


    </script>
</body>
</html>
